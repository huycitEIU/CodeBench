@startuml Lazy_Loading_Detail_V2

actor User
participant "MainController" as CTRL
participant "TestResultRow" as ROW
participant "TestCase (Record)" as TC
participant "FileIOService" as IO
participant "ViewHelper" as VIEW

User -> CTRL : Right Click Row -> "Xem chi tiết"
activate CTRL

' 1. Lấy đường dẫn file
CTRL -> ROW : getActualOutputPath()
ROW --> CTRL : Path("/temp/run_1/test1_out.txt")

CTRL -> ROW : getExpectedOutputPath()
ROW -> TC : expectedOutputPath()
note right: Gọi kiểu Record (không có get...)
TC --> ROW : Path("/data/test1.out")
ROW --> CTRL : Path("/data/test1.out")

' 2. Đọc nội dung (Lazy Loading)
note right of CTRL
  Chỉ đọc 20KB đầu tiên để tránh tràn bộ nhớ
  nếu file output quá lớn (vd: lặp vô hạn in ra 1GB)
end note

CTRL -> IO : readPreview(actualPath)
IO --> CTRL : String "Actual content..."

CTRL -> IO : readPreview(expectedPath)
IO --> CTRL : String "Expected content..."

' 3. Hiển thị Dialog qua Helper
CTRL -> VIEW : showDiffDialog(title, expected, actual)
activate VIEW
VIEW --> User : Display Comparison Dialog
deactivate VIEW

deactivate CTRL
@enduml